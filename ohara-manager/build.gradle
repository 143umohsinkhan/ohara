task clean {
  doLast {
    exec {
      commandLine 'yarn', 'clean'
    }
  }
}

task cleanProcess {
  doLast {
    exec {
      commandLine 'yarn', 'clean:process'
    }
  }
}

task test {
  doLast {
    exec {
      commandLine 'yarn', 'test:ci'
    }
  }
  finalizedBy cleanProcess
}

task build {
  dependsOn test
}

task runManager {
  description 'run a manager'
  doLast {
    exec {
      commandLine 'fuser', '-k', '5050/tcp'
      commandLine 'yarn', 'clean'
      commandLine 'yarn', 'setup'
      String configuratorPort = 9999
      if(project.hasProperty('configuratorPort')) configuratorPort = "${project.getProperty('configuratorPort')}"
      environment "CONFIGURATOR_API", "http://localhost:" + configuratorPort + "/v0"
      commandLine 'yarn', 'start'
    }
  }
}