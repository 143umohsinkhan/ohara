task cleanFile {
  doLast {
    exec {
      commandLine 'yarn', 'clean'
    }
  }
}

task setup {
  doLast {
    exec {
      commandLine 'yarn', 'setup'
    }
  }
}

task cleanProcess {
  doLast {
    exec {
      commandLine 'yarn', 'clean:process'
    }
  }
}

task clean {
  dependsOn setup
  doLast {
    exec {
      commandLine 'yarn', 'clean:process'
    }
  }
  finalizedBy cleanFile
}


task test {
  doLast {
    exec {
      commandLine 'yarn', 'test:ci'
    }
  }
  finalizedBy cleanProcess
}

task build {
  dependsOn test
}

task cleanAndSetup {
  dependsOn clean
  doLast {
    exec {
      commandLine 'yarn', 'setup'
    }
  }
}


task runManager {
  description 'run a manager'
  dependsOn cleanAndSetup
  doLast {
    exec {
      String configuratorPort = 9999
      if(project.hasProperty('configuratorPort')) configuratorPort = "${project.getProperty('configuratorPort')}"
      String configuratorHost = "localhost"
      if(project.hasProperty('configuratorHost')) configuratorHost = "${project.getProperty('configuratorHost')}"
      environment "CONFIGURATOR_API", "http://" + configuratorHost + ":" + configuratorPort + "/v0"
      commandLine 'yarn', 'start'
    }
  }
}